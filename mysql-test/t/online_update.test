--source include/have_myvector.inc
--source include/have_binlog_format_row.inc

CREATE TABLE t1 (c1 INT, c2 VARCHAR(100));
INSERT INTO t1 VALUES (1, '{"vector": [1.1, 2.2, 3.3]}');
INSERT INTO t1 VALUES (2, '{"vector": [2.2, 3.3, 4.4]}');
INSERT INTO t1 VALUES (3, '{"vector": [3.3, 4.4, 5.5]}');

-- Create an index
SELECT myvector_index_build('idx_binlog', 't1', 'c2', 'vector');
--SELECT myvector_index_status('idx_binlog');

-- Insert a new row and check if the index size increases
INSERT INTO t1 VALUES (4, '{"vector": [4.4, 5.5, 6.6]}');
--SELECT myvector_index_status('idx_binlog');

-- Update a row
UPDATE t1 SET c2 = '{"vector": [9.9, 9.9, 9.9]}' WHERE c1 = 4;
SELECT c1 FROM t1 WHERE myvector_is_ann('idx_binlog', '{"vector": [9.9, 9.9, 9.9]}', 1);

-- Delete a row and check if the index size decreases
DELETE FROM t1 WHERE c1 = 4;
--SELECT myvector_index_status('idx_binlog');

-- Drop the index
SELECT myvector_index_drop('idx_binlog');
DROP TABLE t1;
