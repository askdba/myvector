--source include/have_myvector.inc

--echo #
--echo # Test Indexing and Search
--echo #

CREATE TABLE t1 (c1 INT, c2 VARCHAR(100));
INSERT INTO t1 VALUES (1, '{"vector": [1.1, 2.2, 3.3]}');
INSERT INTO t1 VALUES (2, '{"vector": [2.2, 3.3, 4.4]}');
INSERT INTO t1 VALUES (3, '{"vector": [3.3, 4.4, 5.5]}');

--echo # Create, save, drop, load, and search index
SELECT myvector_index_build('idx1', 't1', 'c2', 'vector');
SELECT myvector_index_save('idx1');
SELECT myvector_index_drop('idx1');
SELECT myvector_index_load('idx1');

SELECT c1 FROM t1 WHERE myvector_is_ann('idx1', '{"vector": [1.0, 2.0, 3.0]}', 2);

SELECT myvector_index_drop('idx1');
DROP TABLE t1;
